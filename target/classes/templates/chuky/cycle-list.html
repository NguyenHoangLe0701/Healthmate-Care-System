<!DOCTYPE html>
<html
  lang="vi"
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layout}"
>
  <head>
    <title>L·ªãch s·ª≠ chu k·ª≥</title>
    <meta charset="UTF-8" />
    <link rel="stylesheet" th:href="@{/css/cycle.css}" />
  </head>
  <body>
    <div layout:fragment="content">
      <div class="cycle-bg">
        <div class="cycle-container">
          <div class="cycle-left">
            <h1>C√¥ng c·ª• t√≠nh ng√†y r·ª•ng tr·ª©ng</h1>
            <p>
              Kh√°m ph√° c√¥ng c·ª• t√≠nh ng√†y r·ª•ng tr·ª©ng online ch√≠nh x√°c v√† ti·ªán
              l·ª£i, xem chu k·ª≥ kinh nguy·ªát v√† ng√†y an to√†n, gi√∫p b·∫°n l√™n k·∫ø ho·∫°ch
              mang thai hi·ªáu qu·∫£.
            </p>
            <div class="doctor">
              Th√¥ng tin ƒë∆∞·ª£c ki·ªÉm ch·ª©ng b·ªüi<br />
              <a href="#" style="color: #1976d2; text-decoration: underline"
                >B√°c sƒ© Tr∆∞∆°ng Vƒ©nh Th√°i</a
              >
            </div>
            <img
              src="https://www.medigoapp.com/assets/images-html/safe-day-tool/safe-day-bg.png"
              alt="L·ªãch chu k·ª≥"
            />
          </div>
          <div class="cycle-right">
            <!-- Th√¥ng b√°o l·ªói/th√†nh c√¥ng -->
            <div th:if="${error}" class="alert alert-error" style="background-color: #fee; color: #c33; padding: 10px; margin-bottom: 15px; border-radius: 4px; border: 1px solid #fcc;">
              <strong>L·ªói:</strong> <span th:text="${error}"></span>
              <a th:if="${duplicateCycleId}" th:href="@{/cycles/edit/{id}(id=${duplicateCycleId})}" 
                 style="margin-left: 10px; color: #1976d2; text-decoration: underline;">
                C·∫≠p nh·∫≠t chu k·ª≥ hi·ªán c√≥
              </a>
            </div>
            <div th:if="${success}" class="alert alert-success" style="background-color: #efe; color: #3c3; padding: 10px; margin-bottom: 15px; border-radius: 4px; border: 1px solid #cfc;">
              <strong>Th√†nh c√¥ng:</strong> <span th:text="${success}"></span>
            </div>
            
            <div class="cycle-form-section">
              <h2 th:text="${cycle.id != null ? 'Ch·ªânh s·ª≠a chu k·ª≥' : 'Nh·∫≠p th√¥ng tin c·ªßa b·∫°n'}"></h2>
              <form th:object="${cycle}" th:action="${cycle.id != null ? '/cycles/edit/' + cycle.id : '/cycles/add'}" method="post">
                <input type="hidden" th:if="${cycle.id != null}" th:field="*{id}" />
                <div class="cycle-form-group">
                  <label class="cycle-method-label">
                    Ch·ªçn ph∆∞∆°ng ph√°p t√≠nh to√°n
                    <span style="color: #e83e8c">*</span>
                  </label>
                  <div class="cycle-method-desc">
                    L·ª±a ch·ªçn ph∆∞∆°ng ph√°p t√≠nh to√°n ph√π h·ª£p v·ªõi b·∫°n
                  </div>
                  <div class="cycle-method-select">
                    <input
                      type="radio"
                      id="method1"
                      name="method"
                      value="regular"
                      th:field="*{method}"
                      checked
                      onchange="updateIrregularInfo()"
                    />
                    <label for="method1" class="cycle-method-box">
                      <img
                        src="https://www.medigoapp.com/assets/images-html/due_date_method_1.png"
                        alt="ƒê·ªÅu ƒë·∫∑n"
                      />
                      <div>Chu k√¨ kinh nguy·ªát ƒë·ªÅu ƒë·∫∑n</div>
                    </label>
                    <input
                      type="radio"
                      id="method2"
                      name="method"
                      value="irregular"
                      th:field="*{method}"
                      onchange="updateIrregularInfo()"
                    />
                    <label for="method2" class="cycle-method-box">
                      <img
                        src="https://www.medigoapp.com/assets/images-html/due_date_method_2.png"
                        alt="Kh√¥ng ƒë·ªÅu"
                      />
                      <div>Chu k√¨ kinh nguy·ªát kh√¥ng ƒë·ªÅu</div>
                    </label>
                  </div>
                  <div id="irregularInfo" style="display: none; margin-top: 10px; padding: 10px; background-color: #fff3cd; border: 1px solid #ffc107; border-radius: 4px; color: #856404;">
                    <strong>üí° L∆∞u √Ω:</strong> V·ªõi chu k·ª≥ kh√¥ng ƒë·ªÅu, vui l√≤ng nh·∫≠p <strong>ƒë·ªô d√†i chu k·ª≥ trung b√¨nh</strong> c·ªßa b·∫°n (t√≠nh t·ª´ 3-6 chu k·ª≥ g·∫ßn nh·∫•t). 
                    V√≠ d·ª•: n·∫øu c√°c chu k·ª≥ c·ªßa b·∫°n l√† 25, 28, 30, 27 ng√†y, h√£y nh·∫≠p trung b√¨nh l√† 27-28 ng√†y.
                  </div>
                </div>
                <div class="cycle-form-group">
                  <label class="cycle-label"
                    >Ng√†y ƒë·∫ßu ti√™n c·ªßa chu k·ª≥ kinh nguy·ªát g·∫ßn nh·∫•t
                    <span style="color: #e83e8c">*</span></label
                  >
                  <input
                    type="date"
                    th:field="*{startDate}"
                    class="cycle-input"
                    required
                    max=""
                    id="startDateInput"
                  />
                </div>
                <div class="cycle-form-group">
                  <label class="cycle-label" id="cycleLengthLabel"
                    >ƒê·ªô d√†i chu k·ª≥ kinh c·ªßa b·∫°n
                    <span style="color: #e83e8c">*</span></label
                  >
                  <select
                    th:field="*{cycleLength}"
                    class="cycle-select"
                    required
                  >
                    <option th:value="20" th:text="'20 ng√†y'"></option>
                    <option th:value="21" th:text="'21 ng√†y'"></option>
                    <option th:value="22" th:text="'22 ng√†y'"></option>
                    <option th:value="23" th:text="'23 ng√†y'"></option>
                    <option th:value="24" th:text="'24 ng√†y'"></option>
                    <option th:value="25" th:text="'25 ng√†y'"></option>
                    <option th:value="26" th:text="'26 ng√†y'"></option>
                    <option th:value="27" th:text="'27 ng√†y'"></option>
                    <option th:value="28" th:text="'28 ng√†y'"></option>
                    <option th:value="29" th:text="'29 ng√†y'"></option>
                    <option th:value="30" th:text="'30 ng√†y'"></option>
                    <option th:value="31" th:text="'31 ng√†y'"></option>
                    <option th:value="32" th:text="'32 ng√†y'"></option>
                    <option th:value="33" th:text="'33 ng√†y'"></option>
                    <option th:value="34" th:text="'34 ng√†y'"></option>
                    <option th:value="35" th:text="'35 ng√†y'"></option>
                    <option th:value="36" th:text="'36 ng√†y'"></option>
                    <option th:value="37" th:text="'37 ng√†y'"></option>
                    <option th:value="38" th:text="'38 ng√†y'"></option>
                    <option th:value="39" th:text="'39 ng√†y'"></option>
                    <option th:value="40" th:text="'40 ng√†y'"></option>
                  </select>
                </div>
                <div class="cycle-form-group">
                  <label class="cycle-label"
                    >S·ªë ng√†y h√†nh kinh
                    <span style="color: #e83e8c">*</span></label
                  >
                  <select
                    th:field="*{periodLength}"
                    class="cycle-select"
                    required
                  >
                    <option th:value="3" th:text="'3 ng√†y'"></option>
                    <option th:value="4" th:text="'4 ng√†y'"></option>
                    <option th:value="5" th:text="'5 ng√†y'"></option>
                    <option th:value="6" th:text="'6 ng√†y'"></option>
                    <option th:value="7" th:text="'7 ng√†y'"></option>
                  </select>
                </div>
                <button type="submit" class="cycle-btn">
                  <span th:text="${cycle.id != null ? 'C·∫≠p nh·∫≠t' : 'T√≠nh ch·ªâ s·ªë ngay'}"></span>
                </button>
                <a th:if="${cycle.id != null}" th:href="@{/cycles}" class="cycle-btn" style="display: inline-block; margin-left: 10px; text-decoration: none; background-color: #888;">
                  H·ªßy
                </a>
              </form>
            </div>
            <div class="cycle-form-section">
              <h2>L·ªãch s·ª≠ chu k·ª≥</h2>
              <table border="1" style="width: 100%; border-collapse: collapse">
                <tr>
                  <th>Ng√†y b·∫Øt ƒë·∫ßu</th>
                  <th>ƒê·ªô d√†i chu k·ª≥</th>
                  <th>S·ªë ng√†y h√†nh kinh</th>
                  <th>Thao t√°c</th>
                </tr>
                <tr th:each="c : ${cycles}">
                  <td th:text="${#temporals.format(c.startDate, 'dd-MM-yyyy')}"></td>
                  <td th:text="${c.cycleLength}"></td>
                  <td th:text="${c.periodLength}"></td>
                  <td style="white-space: nowrap;">
                    <a th:href="@{/cycles/details/{id}(id=${c.id})}" style="margin-right: 10px;">Xem</a>
                    <a th:href="@{/cycles/edit/{id}(id=${c.id})}" style="margin-right: 10px; color: #1976d2;">S·ª≠a</a>
                    <form th:action="@{/cycles/delete/{id}(id=${c.id})}" method="post" style="display: inline;" 
                          onsubmit="return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a chu k·ª≥ n√†y? T·∫•t c·∫£ l·ªãch nh·∫Øc li√™n quan c≈©ng s·∫Ω b·ªã x√≥a.');">
                      <button type="submit" style="background: none; border: none; color: #c33; cursor: pointer; text-decoration: underline; padding: 0;">
                        X√≥a
                      </button>
                    </form>
                  </td>
                </tr>
                <tr th:if="${#lists.isEmpty(cycles)}">
                  <td colspan="4" style="text-align: center; color: #888">
                    Kh√¥ng c√≥ d·ªØ li·ªáu chu k·ª≥ n√†o.
                  </td>
                </tr>
              </table>
            </div>
            <div class="cycle-note">
              <span class="icon">‚ÑπÔ∏è</span>
              C√¥ng c·ª• n√†y d·ª±a tr√™n th√¥ng tin m√† b·∫°n cung c·∫•p v√† ch·ªâ mang t√≠nh
              ch·∫•t tham kh·∫£o. N·∫øu b·∫°n ƒëang c·ªë g·∫Øng th·ª• thai hay tr√°nh thai, h√£y
              li√™n h·ªá t∆∞ v·∫•n v·ªõi c√°c b√°c sƒ© c·ªßa ch√∫ng t√¥i qua ·ª©ng d·ª•ng Medigo.
            </div>
          </div>
        </div>
      </div>
      <script>
        // Gi·ªõi h·∫°n startDate kh√¥ng ƒë∆∞·ª£c trong t∆∞∆°ng lai
        document.addEventListener("DOMContentLoaded", function() {
          const startDateInput = document.getElementById("startDateInput");
          if (startDateInput) {
            const today = new Date().toISOString().split('T')[0];
            startDateInput.setAttribute("max", today);
          }
        });
        
        // C·∫≠p nh·∫≠t th√¥ng tin khi ch·ªçn irregular
        function updateIrregularInfo() {
          const method2 = document.getElementById("method2");
          const irregularInfo = document.getElementById("irregularInfo");
          const cycleLengthLabel = document.getElementById("cycleLengthLabel");
          
          if (method2 && method2.checked) {
            if (irregularInfo) irregularInfo.style.display = "block";
            if (cycleLengthLabel) {
              cycleLengthLabel.innerHTML = "ƒê·ªô d√†i chu k·ª≥ trung b√¨nh c·ªßa b·∫°n <span style='color: #e83e8c'>*</span>";
            }
          } else {
            if (irregularInfo) irregularInfo.style.display = "none";
            if (cycleLengthLabel) {
              cycleLengthLabel.innerHTML = "ƒê·ªô d√†i chu k·ª≥ kinh c·ªßa b·∫°n <span style='color: #e83e8c'>*</span>";
            }
          }
        }
        
        // G·ªçi khi trang load ƒë·ªÉ set ƒë√∫ng tr·∫°ng th√°i
        document.addEventListener("DOMContentLoaded", function() {
          updateIrregularInfo();
        });
      </script>
    </div>
  </body>
</html>
